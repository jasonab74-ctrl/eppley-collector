<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dr. Barry Eppley – Open Data Hub</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0b0d10; --card:#11151b; --fg:#e6edf3; --muted:#9aa7b2; --line:#1c232b;
    --accent:#22c55e; --danger:#ef4444; --link:#93c5fd;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#ffffff; --card:#f7f7f8; --fg:#0e141b; --muted:#586271; --line:#e4e7eb; --link:#0b6ef9; }
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
  a{color:var(--link);text-decoration:none}
  a:hover{text-decoration:underline}
  .wrap{max-width:980px;margin:0 auto;padding:22px}
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{font-size:clamp(24px,5vw,40px);margin:0}
  .sub{color:var(--muted);margin:6px 0 0}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--card);color:var(--muted);font-size:13px}
  .ok{border-color:rgba(34,197,94,.4);color:#a7f3d0;background:rgba(34,197,94,.10)}
  .bad{border-color:rgba(239,68,68,.4);color:#fecaca;background:rgba(239,68,68,.08)}
  .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:16px}
  @media(min-width:760px){.grid{grid-template-columns:1.1fr .9fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
  .kpis{display:flex;gap:10px;flex-wrap:wrap}
  .kbox{border:1px solid var(--line);border-radius:10px;padding:10px 12px;min-width:140px;background:transparent}
  .kcap{color:var(--muted);font-size:12px}
  .kval{font-weight:800;font-size:20px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
  th{color:var(--muted);font-weight:600}
  .oktxt{color:#16a34a;font-weight:700}
  .badtxt{color:#dc2626;font-weight:700}
  footer{color:var(--muted);margin:18px 0 6px}
  code{background:rgba(125,125,125,.14);padding:2px 6px;border-radius:6px}
  .note{color:var(--muted);font-size:13px;margin-top:8px}
  .btns{display:flex;gap:10px;flex-wrap:wrap}
  .btn{display:inline-block;padding:8px 12px;border-radius:8px;border:1px solid var(--line);background:var(--card)}
  .btn:focus{outline:2px solid var(--line)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Dr. Barry Eppley — Open Data Hub</h1>
      <p class="sub">Live CSV archive (blog posts, papers, registries, ORCID/OpenAlex, YouTube). Updated whenever PRs merge into <code>main</code>.</p>
      <div class="chips">
        <span class="chip" id="chip-data">Data: —</span>
        <span class="chip" id="chip-updated">Last updated: —</span>
      </div>
    </div>
    <div class="btns">
      <a class="btn" href="https://github.com/jasonab74-ctrl/eppley-collector" target="_blank" rel="noopener">View Repo</a>
      <a class="btn" href="./status.html">Status</a>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <h3 style="margin:6px 0 8px">Dataset at a glance</h3>
      <div class="kpis">
        <div class="kbox">
          <div class="kcap">Files</div>
          <div class="kval" id="k-files">—</div>
        </div>
        <div class="kbox">
          <div class="kcap">Total rows</div>
          <div class="kval" id="k-rows">—</div>
        </div>
        <div class="kbox">
          <div class="kcap">WordPress posts</div>
          <div class="kval" id="k-wp">—</div>
        </div>
        <div class="kbox">
          <div class="kcap">Publications (Crossref)</div>
          <div class="kval" id="k-cr">—</div>
        </div>
      </div>
      <p class="note">Counts are computed client-side by fetching the CSV headers and lines from <code>/output/</code> on this site—no server needed.</p>
    </section>

    <section class="card">
      <h3 style="margin:6px 0 8px">Quick links</h3>
      <ul style="margin:0;padding-left:18px">
        <li><a href="./output/wordpress_posts.csv">wordpress_posts.csv</a></li>
        <li><a href="./output/pubmed_eppley.csv">pubmed_eppley.csv</a></li>
        <li><a href="./output/crossref_works.csv">crossref_works.csv</a></li>
        <li><a href="./output/openalex_works.csv">openalex_works.csv</a></li>
        <li><a href="./output/clinical_trials.csv">clinical_trials.csv</a></li>
        <li><a href="./output/orcid_profiles.csv">orcid_profiles.csv</a></li>
        <li><a href="./output/orcid_works.csv">orcid_works.csv</a></li>
        <li><a href="./output/youtube_all.csv">youtube_all.csv</a></li>
      </ul>
      <p class="note">Right-click → “Save link as…” to download a CSV. CSV links are stable.</p>
    </section>
  </div>

  <section class="card" style="margin-top:14px">
    <h3 style="margin:6px 0 8px">File details</h3>
    <table id="files">
      <thead>
      <tr><th>File</th><th>Description</th><th>Rows</th><th>Status</th><th>Download</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <footer>
    Site URL: <a href="https://jasonab74-ctrl.github.io/eppley-collector/">https://jasonab74-ctrl.github.io/eppley-collector/</a>
  </footer>
</div>

<script>
(async () => {
  // Files we expect
  const files = [
    ["wordpress_posts.csv","All blog/Q&A posts"],
    ["pubmed_eppley.csv","PubMed summary"],
    ["crossref_works.csv","Crossref works"],
    ["openalex_works.csv","OpenAlex works"],
    ["clinical_trials.csv","ClinicalTrials.gov"],
    ["orcid_profiles.csv","ORCID profiles"],
    ["orcid_works.csv","ORCID works"],
    ["youtube_all.csv","YouTube metadata"]
  ];

  const base = location.pathname.replace(/\/[^\/]*$/, "") + "/output/";
  const tbody = document.querySelector("#files tbody");
  const chipData = document.getElementById("chip-data");
  const chipUpd  = document.getElementById("chip-updated");
  const kFiles = document.getElementById("k-files");
  const kRows  = document.getElementById("k-rows");
  const kWP    = document.getElementById("k-wp");
  const kCR    = document.getElementById("k-cr");

  function row(name, desc, rows, ok) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td style="font-family:ui-monospace,Menlo,Consolas,monospace">${name}</td>
      <td>${desc}</td>
      <td>${rows >= 0 ? rows : "—"}</td>
      <td>${ok ? '<span class="oktxt">ok</span>' : '<span class="badtxt">missing</span>'}</td>
      <td><a href="./output/${name}">CSV</a></td>`;
    tbody.appendChild(tr);
  }

  async function countRows(url) {
    try {
      const r = await fetch(url, {cache:'no-store'});
      if (!r.ok) return -1;
      const text = await r.text();
      if (!text) return 0;
      // Count lines and subtract header (first line)
      const lines = text.replace(/\r/g,'').split('\n').filter(Boolean);
      return Math.max(0, lines.length - 1);
    } catch { return -1; }
  }

  // Build table + KPIs
  let totalRows = 0, present = 0, wpRows = 0, crRows = 0;
  for (const [name, desc] of files) {
    const rows = await countRows(base + name);
    const ok = rows >= 0;
    if (ok) present++;
    if (rows > 0) totalRows += rows;
    if (name === "wordpress_posts.csv") wpRows = Math.max(rows,0);
    if (name === "crossref_works.csv")  crRows = Math.max(rows,0);
    row(name, desc, rows, ok);
  }
  kFiles.textContent = `${present}/${files.length}`;
  kRows.textContent  = totalRows.toLocaleString();
  kWP.textContent    = wpRows.toLocaleString();
  kCR.textContent    = crRows.toLocaleString();

  // Badges
  const allOk = (present === files.length);
  chipData.textContent = "Data: " + (allOk ? "ready" : "incomplete");
  chipData.className = "chip " + (allOk ? "ok" : "bad");

  // Show last updated from Git metadata if available via Pages cache-buster
  try {
    // Lightweight heuristic: use the newest CSV’s Last-Modified header
    const head = await fetch(base + "crossref_works.csv", {method:"HEAD", cache:"no-store"});
    const lm = head.headers.get("last-modified");
    chipUpd.textContent = "Last updated: " + (lm ? (new Date(lm)).toUTCString() : "—");
    chipUpd.className = "chip";
  } catch {
    chipUpd.textContent = "Last updated: —";
  }
})();
</script>
</body>
</html>
