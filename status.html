<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Data Status</title>
<style>
  body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;background:#0b0d10;color:#e6edf3}
  .wrap{max-width:880px;margin:0 auto;padding:20px}
  h1{margin:0 0 10px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #1c232b;text-align:left}
  th{color:#9aa7b2}
  a{color:#93c5fd;text-decoration:none}
  a:hover{text-decoration:underline}
  .ok{color:#16a34a;font-weight:700}
  .bad{color:#dc2626;font-weight:700}
</style>
<div class="wrap">
  <h1>Data Status</h1>
  <p id="when" style="color:#9aa7b2">Last updated: —</p>
  <table id="t">
    <thead><tr><th>File</th><th>Rows</th><th>Status</th><th>Link</th></tr></thead>
    <tbody></tbody>
  </table>
</div>
<script>
(async()=>{
  const files = ["wordpress_posts.csv","pubmed_eppley.csv","crossref_works.csv","openalex_works.csv","clinical_trials.csv","orcid_profiles.csv","orcid_works.csv","youtube_all.csv"];
  const base = location.pathname.replace(/\/[^\/]*$/, "") + "/output/";
  const tb = document.querySelector("#t tbody");
  async function count(u){ try{ const r=await fetch(u,{cache:'no-store'}); if(!r.ok){return -1} const t=await r.text(); const n=t.replace(/\r/g,'').split('\n').filter(Boolean).length-1; return Math.max(0,n);}catch{return -1} }
  let newest=0;
  for(const f of files){
    const rows = await count(base+f);
    const ok   = rows >= 0;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${f}</td><td>${rows>=0?rows:"—"}</td><td class="${ok?"ok":"bad"}">${ok?"ok":"missing"}</td><td><a href="./output/${f}">CSV</a></td>`;
    tb.appendChild(tr);
    try{
      const h = await fetch(base+f,{method:"HEAD",cache:"no-store"});
      const lm = h.headers.get("last-modified");
      if(lm) newest = Math.max(newest, +new Date(lm));
    }catch{}
  }
  document.getElementById("when").textContent = "Last updated: " + (newest? new Date(newest).toUTCString() : "—");
})();
</script>
